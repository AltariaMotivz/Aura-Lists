<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Magical Wishlist</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@700&family=Poppins:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>

    <!-- The Authentication Gateway -->
    <div id="auth-container">
        <div class="auth-box">
            <h1>Crystal Wishlist</h1>
            <p>Enter your phone number to begin</p>
            <form id="phone-form">
                <input type="tel" id="phone-number" placeholder="+12015550123" required>
                <button type="submit" id="sign-in-button">Send Code</button>
            </form>
            <form id="code-form" class="hidden">
                 <input type="text" id="code-input" placeholder="123456" required>
                 <button type="submit" id="verify-code-button">Verify Code</button>
            </form>
            <div id="recaptcha-container"></div>
            <p id="auth-status" class="auth-status"></p>
        </div>
    </div>
    
    <!-- The Main Application, hidden by default -->
    <div id="app-container" class="hidden">
        <div class="page-container">
            <header>
                <h1>Crystal Wishlist</h1>
                <nav>
                    <button id="dashboard-nav-btn" class="nav-btn active">Dashboard</button>
                    <button id="my-wishlist-nav-btn" class="nav-btn">My Wishlist</button>
                </nav>
                <button id="sign-out-button" class="sign-out-btn">Sign Out</button>
            </header>

            <!-- Dashboard Page -->
            <div id="dashboard-page">
                <div class="friend-id-container">
                    <h2>Share Your Friend ID</h2>
                    <p>Give this ID to friends so they can add you!</p>
                    <div id="user-friend-id" class="friend-id-box">Loading...</div>
                </div>
                <div class="friends-container">
                    <h2>Friends' Wishlists</h2>
                    <div id="friends-wishlist-grid">
                        <p id="no-friends-message">You haven't added any friends yet. Add one to see their wishes!</p>
                    </div>
                    <button id="addFriendBtn" class="btn-primary">+ Add a Friend</button>
                </div>
            </div>

            <!-- My Wishlist Page -->
            <div id="my-wishlist-page" class="hidden">
                <main class="wishlist-grid" id="wishlistGrid">
                    <p id="loadingMessage">Summoning your wishes...</p>
                </main>
                <button class="floating-add-btn" id="openAddWishModalBtn">+</button>
            </div>

             <!-- A new page to view a friend's wishlist -->
            <div id="friend-wishlist-page" class="hidden">
                <h2 id="friend-wishlist-title"></h2>
                <main class="wishlist-grid" id="friendWishlistGrid"></main>
            </div>
        </div>

        <!-- Modals -->
        <div class="modal-backdrop" id="addWishModalBackdrop">
            <!-- Existing Add Wish Modal -->
            <div class="modal">
                <h2>Add a New Wish</h2>
                <form id="addWishForm">
                    <label for="itemName">Wish Title</label>
                    <input type="text" id="itemName" name="itemName" required>
                    <label for="itemLink">Link to Item</label>
                    <input type="url" id="itemLink" name="itemLink">
                    <label for="itemNotes">Notes</label>
                    <textarea id="itemNotes" name="itemNotes" rows="3"></textarea>
                    <label for="itemImage">Image URL</label>
                    <input type="url" id="itemImage" name="itemImage">
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelWishBtn">Cancel</button>
                        <button type="submit" class="btn-primary">Add Wish</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal-backdrop" id="addFriendModalBackdrop">
            <!-- New Add Friend Modal -->
             <div class="modal">
                <h2>Add a New Friend</h2>
                <form id="addFriendForm">
                    <label for="friendIdInput">Friend's ID</label>
                    <input type="text" id="friendIdInput" name="friendIdInput" required>
                    <p id="add-friend-status" class="auth-status"></p>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelFriendBtn">Cancel</button>
                        <button type="submit" class="btn-primary">Add Friend</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase Magic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCdAVpYhcdurxJLnZmvesIEHsN3pBWquF8",
            authDomain: "crystal-wishlist.firebaseapp.com",
            projectId: "crystal-wishlist",
            storageBucket: "crystal-wishlist.firebasestorage.app",
            messagingSenderId: "383897040491",
            appId: "1:383897040491:web:4a67e7549a8ed75e1a232e",
            measurementId: "G-CRL695ERCJ"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        const appCheck = initializeAppCheck(app, {
            provider: new ReCaptchaV3Provider("6LelUu8rAAAAALvWQUxFdU4MEFQLqtF0z5N7djBh"),
            isTokenAutoRefreshEnabled: true
        });
        
        window.db = getFirestore(app);
        window.auth = getAuth(app);
    </script>
    
    <script type="module" src="script.js"></script>

</body>
</html>

