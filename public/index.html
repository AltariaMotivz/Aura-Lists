<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Wishlist</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@700&family=Poppins:wght@400;5A00&display=swap"
        rel="stylesheet">
</head>

<body>

    <!-- Authentication Gateway (Perfect) -->
    <div id="auth-container">
        <div class="auth-box">
            <h1>Crystal Wishlist</h1>
            <p>Enter your phone number to begin</p>
            <form id="phone-form">
                <input type="tel" id="phone-number" placeholder="+12015550123" required>
                <button type="submit" id="sign-in-button">Send Code</button>
            </form>
            <form id="code-form" class="hidden">
                <input type="text" id="code-input" placeholder="123456" required>
                <button type="submit" id="verify-code-button">Verify Code</button>
            </form>
            <div id="recaptcha-container"></div>
            <p id="auth-status" class="auth-status"></p>
        </div>
    </div>

    <!-- Main Application (Re-enchanted!) -->
    <div id="app-container" class="hidden">
        <div class="page-container">

            <!-- Header (Perfect) -->
            <header>
                <h1 id="pageTitle">Aura List</h1>
                <button id="shareLinkBtn" class="btn-secondary small hidden" style="margin-right: 10px;">Share
                    Link</button>
                <button id="sign-out-button" class="sign-out-btn">Sign Out</button>
            </header>

            <!-- Navigation Tabs (Perfect) -->
            <nav class="tabs">
                <button id="dashboardTab" class="tab-btn active">Dashboard</button>
                <button id="myWishlistTab" class="tab-btn">My Wishlist</button>
            </nav>

            <!-- == PAGE 1: Dashboard (Perfect) == -->
            <main id="dashboardPage" class="dashboard-grid">

                <div class="profile-box glass-panel">
                    <h3>Your Profile</h3>

                    <form id="name-form" class="name-form">
                        <label for="name-input">Your Display Name:</label>
                        <input type="text" id="name-input" placeholder="Enter your name">
                        <button type"submit" class="btn-primary-small">Save Name</button>
                    </form>
                    <p id="name-status" class="status-text"></p>
                </div>

                <div class="friends-list-box glass-panel">
                    <div class="friends-header">
                        <h3>Friends' Wishlists</h3>
                        <button id="addFriendBtn" class="floating-add-btn-small">+</button>
                    </div>
                    <div id="friendWishlistGridContainer">
                        <p id="friendsLoadingMessage">Summoning your friends...</p>
                    </div>
                </div>
            </main>

            <!-- == PAGE 2: My Wishlist (FIX #1) == -->
            <!-- The 'main' element is the page container. -->
            <!-- The 'wishlistGrid' is now a 'div' INSIDE it. -->
            <main id="myWishlistPage" class="hidden">
                <p id="loadingMessage" style="text-align: center; color: var(--text-muted);">Summoning your wishes...
                </p>
                <div id="wishlistGrid" class="wishlist-grid">
                    <!-- My wishes will be magically summoned here! -->
                </div>
            </main>

            <!-- == PAGE 3: Friend's Wishlist (NEW) == -->
            <main id="friendWishlistPage" class="hidden">
                <div class="friend-page-header">
                    <button id="backToDashboardBtn" class="btn-secondary small">‚Üê Back to Dashboard</button>
                    <h2 id="friendPageTitle">Friend's Wishlist</h2>
                </div>
                <div id="friendWishlistContainer" class="wishlist-grid">
                    <!-- Friend's wishes will be summoned here -->
                </div>
            </main>

            <!-- Floating 'Add Wish' Button (Perfect) -->
            <button class="floating-add-btn hidden" id="addWishBtn">+</button>

        </div>

        <!-- === Modals (All Perfect) === -->

        <div class="modal-backdrop" id="addWishModalBackdrop">
            <div class="modal">
                <h2>Add a New Wish</h2>
                <form id="addWishForm">
                    <label for="itemName">Wish Title</label>
                    <input type="text" id="itemName" name="itemName" placeholder="e.g., A Book of Spells" required>
                    <label for="itemLink">Link to Item (optional)</label>
                    <input type="url" id="itemLink" name="itemLink" placeholder="https://magical-emporium.com/...">
                    <label for="itemNotes">Notes (optional)</label>
                    <textarea id="itemNotes" name="itemNotes" rows="3"
                        placeholder="Any details, colors, or enchantments..."></textarea>
                    <label for="itemImage">Image URL (optional)</label>
                    <input type="url" id="itemImage" name="itemImage"
                        placeholder="https://magical-emporium.com/image.png">
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelAddWishBtn">Cancel</button>
                        <button type="submit" class="btn-primary">Add Wish</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal-backdrop" id="addFriendModalBackdrop">
            <div class="modal">
                <h2>Add a New Friend</h2>
                <form id="addFriendForm">
                    <label for="friendIdInput">Friend's Phone Number</label>
                    <input type="tel" id="friendIdInput" placeholder="e.g. 555-555-5555" required>
                    <p id="addFriendStatus" class="status-text"></p>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelAddFriendBtn">Cancel</button>
                        <button type="submit" class="btn-primary">Add Friend</button>
                    </div>
                </form>
            </div>
        </div>




        <!-- Guest Mode CTA -->
        <div id="guest-cta" class="guest-cta hidden">
            <p>Want your own Aura List?</p>
            <button id="create-own-btn" class="btn-primary">Create Free Account</button>
        </div>

    </div>

    <!-- === FIREBASE MAGIC (FIX #2) === -->
    <script type="module">
        // Import all your Firebase spells...
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

        // This line now correctly includes 'getDocs'
        import { getFirestore, doc, getDoc, getDocs, setDoc, addDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        import { getAuth, onAuthStateChanged, RecaptchaVerifier, signInWithPhoneNumber, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdAVpYhcdurxJLnZmvesIEHsN3pBWquF8",
            authDomain: "crystal-wishlist.firebaseapp.com",
            projectId: "crystal-wishlist",
            storageBucket: "crystal-wishlist.firebasestorage.app",
            messagingSenderId: "383897040491",
            appId: "1:383897040491:web:4a67e7549a8ed75e1a232e",
            measurementId: "G-CRL695ERCJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // Make db and auth globally available on the window
        window.db = getFirestore(app);
        window.auth = getAuth(app);
    </script>

    <!-- === YOUR MAGICAL SPELLBOOK (Perfect) === -->
    <script type="module" src="script.js?v=2.3"></script>

</body>

</html>